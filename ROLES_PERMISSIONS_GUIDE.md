# ğŸ” Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³ÛŒØ³ØªÙ… Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ - Ù…ÛŒÚ©Ø±ÙˆØ¨ÛŒÙ…Ù‡

## ğŸ“‹ Ù…Ø¹Ø±ÙÛŒ

Ø³ÛŒØ³ØªÙ… Ù…ÛŒÚ©Ø±ÙˆØ¨ÛŒÙ…Ù‡ Ø§Ø² Ù¾Ú©ÛŒØ¬ `spatie/laravel-permission` Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯. Ø§ÛŒÙ† Ø³ÛŒØ³ØªÙ… Ø´Ø§Ù…Ù„ Ø³Ù‡ Ø±ÙˆÙ„ Ø§ØµÙ„ÛŒ Ø§Ø³Øª:

- **ğŸ‘‘ Admin (Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…)**: Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ ØªÙ…Ø§Ù… Ø¨Ø®Ø´â€ŒÙ‡Ø§
- **ğŸ¥ Charity (Ø®ÛŒØ±ÛŒÙ‡)**: Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒÙ‡Ø§ Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡
- **ğŸ›¡ï¸ Insurance (Ø¨ÛŒÙ…Ù‡)**: Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡

## ğŸ¯ Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§

### ğŸ‘‘ Admin (Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…)
**Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡:**
- `manage users` - Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
- `manage organizations` - Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§
- `manage roles` - Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÙ„â€ŒÙ‡Ø§
- `manage permissions` - Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§
- `view system logs` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
- `manage system settings` - ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…
- `view all statistics` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ø¢Ù…Ø§Ø±
- `export reports` - Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§
- `manage regions` - Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù†Ø§Ø·Ù‚
- `view dashboard` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯

### ğŸ¥ Charity (Ø®ÛŒØ±ÛŒÙ‡)
**Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡:**
- `view families` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒÙ‡Ø§
- `create family` - Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯
- `edit family` - ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡
- `delete family` - Ø­Ø°Ù Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡
- `manage family members` - Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡
- `submit insurance request` - Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨ÛŒÙ…Ù‡
- `view own statistics` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù…Ø§Ø± Ø®ÙˆØ¯
- `export own reports` - Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯

### ğŸ›¡ï¸ Insurance (Ø¨ÛŒÙ…Ù‡)
**Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡:**
- `view families` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒÙ‡Ø§
- `review insurance requests` - Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡
- `approve insurance` - ØªØ§ÛŒÛŒØ¯ Ø¨ÛŒÙ…Ù‡
- `reject insurance` - Ø±Ø¯ Ø¨ÛŒÙ…Ù‡
- `view insurance statistics` - Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¢Ù…Ø§Ø± Ø¨ÛŒÙ…Ù‡
- `export insurance reports` - Ø®Ø±ÙˆØ¬ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒÙ…Ù‡

## ğŸ”§ Ù†ØµØ¨ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 1. Ø§Ø¬Ø±Ø§ÛŒ Migrations
```bash
php artisan migrate
```

### 2. Ø§Ø¬Ø±Ø§ÛŒ Seeders
```bash
php artisan db:seed
```

### 3. Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
```bash
php artisan users:create-defaults
```

## ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶

| Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø± | Ø§ÛŒÙ…ÛŒÙ„ | Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± | Ø±ÙˆÙ„ |
|-----------|-------|----------|-----|
| Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ… | admin@microbime.com | Admin@123456 | admin |
| Ø®ÛŒØ±ÛŒÙ‡ | charity@microbime.com | Charity@123456 | charity |
| Ø¨ÛŒÙ…Ù‡ | insurance@microbime.com | Insurance@123456 | insurance |

## ğŸ›¡ï¸ Middleware Ù‡Ø§

### CheckUserType
```php
Route::middleware(['auth', 'user.type:admin'])->group(function () {
    // Routes ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ†
});
```

### Spatie Permission Middleware
```php
// Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÙ„
Route::middleware(['role:admin'])->group(function () {
    // Routes ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø±ÙˆÙ„ admin
});

// Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ
Route::middleware(['permission:manage users'])->group(function () {
    // Routes ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ manage users Ø¯Ø§Ø±Ù†Ø¯
});

// Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÙ„ ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ
Route::middleware(['role_or_permission:admin|manage users'])->group(function () {
    // Routes Ø¨Ø±Ø§ÛŒ Ø§Ø¯Ù…ÛŒÙ† ÛŒØ§ Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ manage users Ø¯Ø§Ø±Ù†Ø¯
});
```

## ğŸ“ Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

```
app/
â”œâ”€â”€ Http/
â”‚   â”œâ”€â”€ Middleware/
â”‚   â”‚   â””â”€â”€ CheckUserType.php          # Middleware Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±
â”‚   â””â”€â”€ Kernel.php                     # ØªØ¹Ø±ÛŒÙ middleware Ù‡Ø§
â”œâ”€â”€ Console/
â”‚   â””â”€â”€ Commands/
â”‚       â””â”€â”€ CreateDefaultUsers.php     # Ú©Ø§Ù…Ù†Ø¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶
â””â”€â”€ Models/
    â””â”€â”€ User.php                       # Ù…Ø¯Ù„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ trait HasRoles

database/
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ 2024_01_01_000000_create_laravel_core_tables.php
â”‚   â””â”€â”€ ...
â””â”€â”€ seeders/
    â”œâ”€â”€ PermissionSeeder.php           # Ø§ÛŒØ¬Ø§Ø¯ Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§
    â”œâ”€â”€ RoleSeeder.php                 # Ø§ÛŒØ¬Ø§Ø¯ Ø±ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
    â”œâ”€â”€ AssignRolePermissionSeeder.php # ØªØ®ØµÛŒØµ Ø±ÙˆÙ„â€ŒÙ‡Ø§
    â””â”€â”€ DatabaseSeeder.php             # Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… seeders

routes/
â””â”€â”€ web.php                           # ØªØ¹Ø±ÛŒÙ routes Ø¨Ø§ middleware Ù‡Ø§
```

## ğŸ” Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ú©Ø¯

### Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÙ„ Ø¯Ø± Controller
```php
public function index()
{
    if (auth()->user()->hasRole('admin')) {
        // Ú©Ø¯ Ù…Ø®ØµÙˆØµ Ø§Ø¯Ù…ÛŒÙ†
    }
    
    if (auth()->user()->can('manage users')) {
        // Ú©Ø¯ Ù…Ø®ØµÙˆØµ Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ manage users Ø¯Ø§Ø±Ù†Ø¯
    }
}
```

### Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÙ„ Ø¯Ø± Blade
```blade
@role('admin')
    <p>Ø´Ù…Ø§ Ø§Ø¯Ù…ÛŒÙ† Ù‡Ø³ØªÛŒØ¯</p>
@endrole

@can('manage users')
    <a href="{{ route('admin.users.index') }}">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</a>
@endcan

@hasrole('charity')
    <p>Ø´Ù…Ø§ Ú©Ø§Ø±Ø¨Ø± Ø®ÛŒØ±ÛŒÙ‡ Ù‡Ø³ØªÛŒØ¯</p>
@endhasrole
```

### Ø¨Ø±Ø±Ø³ÛŒ Ø±ÙˆÙ„ Ø¯Ø± Livewire
```php
class FamilyWizard extends Component
{
    public function mount()
    {
        if (!auth()->user()->hasRole('charity')) {
            abort(403);
        }
    }
    
    public function render()
    {
        return view('livewire.charity.family-wizard');
    }
}
```

## ğŸ”„ Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø±ÙˆÙ„ Ø¬Ø¯ÛŒØ¯
```php
use Spatie\Permission\Models\Role;

$role = Role::create(['name' => 'new_role']);
```

### Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ø³ØªØ±Ø³ÛŒ Ø¬Ø¯ÛŒØ¯
```php
use Spatie\Permission\Models\Permission;

$permission = Permission::create(['name' => 'new_permission']);
```

### ØªØ®ØµÛŒØµ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø±ÙˆÙ„
```php
$role = Role::findByName('charity');
$role->givePermissionTo('new_permission');
```

### ØªØ®ØµÛŒØµ Ø±ÙˆÙ„ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
```php
$user = User::find(1);
$user->assignRole('charity');
```

## ğŸš¨ Ù†Ú©Ø§Øª Ù…Ù‡Ù…

1. **ØªØ±ØªÛŒØ¨ Middleware**: Ù‡Ù…ÛŒØ´Ù‡ `auth` Ø±Ø§ Ù‚Ø¨Ù„ Ø§Ø² `role` ÛŒØ§ `permission` Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯
2. **Cache**: spatie/permission Ø§Ø² cache Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù¾Ø³ Ø§Ø² ØªØºÛŒÛŒØ±Ø§Øª cache Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯:
   ```bash
   php artisan permission:cache-reset
   ```
3. **Migration**: Ù‡Ø±Ú¯Ø² Ø¬Ø¯Ø§ÙˆÙ„ permissions Ùˆ roles Ø±Ø§ Ø¯Ø³ØªÛŒ ØªØºÛŒÛŒØ± Ù†Ø¯Ù‡ÛŒØ¯
4. **Seeding**: Ù‡Ù…ÛŒØ´Ù‡ PermissionSeeder Ø±Ø§ Ù‚Ø¨Ù„ Ø§Ø² AssignRolePermissionSeeder Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯

## ğŸ”§ Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Ù…Ø´Ú©Ù„Ø§Øª Ø±Ø§ÛŒØ¬:

1. **Ø®Ø·Ø§ÛŒ "Permission does not exist"**
   ```bash
   php artisan permission:cache-reset
   php artisan db:seed --class=PermissionSeeder
   ```

2. **Ú©Ø§Ø±Ø¨Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±Ø¯**
   ```bash
   php artisan users:create-defaults
   ```

3. **Middleware Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯**
   - Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ Ú©Ù‡ middleware Ø¯Ø± `Kernel.php` ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
   - Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ù‡ route Ø¯Ø± Ú¯Ø±ÙˆÙ‡ middleware ØµØ­ÛŒØ­ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

Ø¨Ø±Ø§ÛŒ Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ø±ÙˆÙ„â€ŒÙ‡Ø§ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§:

1. Ø§Ø¨ØªØ¯Ø§ cache Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯: `php artisan permission:cache-reset`
2. seeders Ø±Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯: `php artisan db:seed`
3. Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø±Ø§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†ÛŒØ¯: `php artisan users:create-defaults`

---

**ğŸ“… Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:** {{ date('Y-m-d') }}  
**ğŸ”— Ù…Ø³ØªÙ†Ø¯Ø§Øª spatie/permission:** https://spatie.be/docs/laravel-permission 