# ๐ ุณุณุชู Queue-based Import ุฎุงููุงุฏูโูุง

ุณุณุชู ุขูพููุฏ ูุงูโูุง ุงฺฉุณู ุจุฑุง ุซุจุช ฺฏุฑูู ุฎุงููุงุฏูโูุง ุจู ุตูุฑุช ููุดููุฏ ุทุฑุงุญ ุดุฏู ฺฉู ุจุณุชู ุจู ุณุงุฒ ูุงูุ ุจู ุฏู ุฑูุด ูุฎุชูู ุนูู ูโฺฉูุฏ:

## ๐ ุชุดุฎุต ุฎูุฏฺฉุงุฑ ููุน ูพุฑุฏุงุฒุด

### ูุงูโูุง ฺฉูฺฺฉ (ฺฉูุชุฑ ุงุฒ 2MB)
- ูพุฑุฏุงุฒุด **ูุณุชูู** ู **ุจโุฏุฑูฺฏ**
- ููุงุด ูุชุฌู ููุฑ ุฏุฑ ููุงู ุตูุญู
- ููุงุณุจ ุจุฑุง ูุงูโูุง ุญุงู ฺฉูุชุฑ ุงุฒ 100 ุฎุงููุงุฏู

### ูุงูโูุง ุจุฒุฑฺฏ (ุจุดุชุฑ ุงุฒ 2MB)  
- ูพุฑุฏุงุฒุด ุฏุฑ **ูพุณโุฒููู** (Background Queue)
- ููุงุด ูพุดโุฑูุช ุจู ุตูุฑุช ุฒูุฏู
- ุงุนูุงูโุฑุณุงู ุงุฒ ุทุฑู ุชูฺฏุฑุงู (ุงุฎุชุงุฑ)
- ููุงุณุจ ุจุฑุง ูุงูโูุง ุญุงู 1000+ ุฎุงููุงุฏู

## ๐๏ธ ูุฒุงุง ุณุณุชู Queue

### โ ูุฒุงุง:
- **ุฌููฺฏุฑ ุงุฒ Timeout**: ูุงูโูุง ุจุฒุฑฺฏ ุจุฏูู ูุทุน ุดุฏู ูพุฑุฏุงุฒุด ูโุดููุฏ
- **ูุฏุฑุช ููุงุจุน**: ุนุฏู ูุตุฑู ุฒุงุฏ ุญุงูุธู ุณุฑูุฑ
- **ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุจูุชุฑ**: ฺฉุงุฑุจุฑ ูุงุฒ ุจู ุงูุชุธุงุฑ ุทููุงู ูุฏุงุฑุฏ
- **ุงุนูุงูโุฑุณุงู**: ฺฉุงุฑุจุฑ ุงุฒ ูุชุฌู ูุทูุน ูโุดูุฏ
- **Progress Tracking**: ููุงุด ูุถุนุช ูพุฑุฏุงุฒุด ุจู ุตูุฑุช ุฒูุฏู
- **ุฎุทุงุงุจ ุจูุชุฑ**: ูุงฺฏ ฺฉุงูู ุงุฒ ุชูุงู ูุฑุงุญู
- **ูุงุจูุช Retry**: ุชูุงุด ูุฌุฏุฏ ุฏุฑ ุตูุฑุช ุดฺฉุณุช

### ๐ ูุฑุขูุฏ ูพุฑุฏุงุฒุด ุฏุฑ Queue:

1. **ุขูพููุฏ ูุงู** โ ุฐุฎุฑู ูููุช ุฏุฑ storage
2. **ุชุดุฎุต ุณุงุฒ** โ ุชุตููโฺฏุฑ ุฑูุด ูพุฑุฏุงุฒุด  
3. **Queue Job** โ ุงุฑุณุงู ุจู ุตู ูพุฑุฏุงุฒุด
4. **Progress Tracking** โ ุจุฑูุฒุฑุณุงู ูุถุนุช ูุฑ 3 ุซุงูู
5. **ูพุฑุฏุงุฒุด ุงฺฉุณู** โ ุฎูุงูุฏู ู ุงุนุชุจุงุฑุณูุฌ ุฏุงุฏูโูุง
6. **ุซุจุช ุฏุฑ ุฏุชุงุจุณ** โ ุงุฌุงุฏ ุฎุงููุงุฏูโูุง ู ุงุนุถุง
7. **ุงุนูุงู ูุชุฌู** โ ููุงุด ุฏุฑ ุฏุงุดุจูุฑุฏ + ุชูฺฏุฑุงู

## ๐ ูุงูโูุง ูุฑุจูุทู:

### Backend:
- `app/Jobs/ProcessFamiliesImport.php` - Job ุงุตู ูพุฑุฏุงุฒุด
- `app/Http/Controllers/Charity/ImportController.php` - ฺฉูุชุฑูุฑ ุขูพููุฏ
- `app/Imports/FamiliesImport.php` - ฺฉูุงุณ import ุงฺฉุณู

### Frontend:  
- `resources/views/charity/dashboard.blade.php` - ููุงุด ูุถุนุช
- `resources/views/livewire/charity/family-search.blade.php` - ููุฏุงู ุขูพููุฏ

### Routes:
- `POST /charity/import` - ุขูพููุฏ ูุงู
- `GET /charity/import/status` - ฺฺฉ ูุถุนุช job

## ๐ง ุชูุธูุงุช ููุฑุฏ ูุงุฒ:

### 1. Queue Driver
ุจุฑุง production ุจูุชุฑ ุงุณุช ุงุฒ Redis ุง Database ุงุณุชูุงุฏู ฺฉูุฏ:
```bash
# ุฏุฑ .env
QUEUE_CONNECTION=database
# ุง 
QUEUE_CONNECTION=redis
```

### 2. ุงุฌุฑุง Queue Worker
```bash
# ุชุณุช (ฺฉ ุจุงุฑ)
php artisan queue:work --once

# Production (ุฏุงู)
php artisan queue:work --daemon --tries=3

# ุจุง Supervisor (ูพุดููุงุฏ)
php artisan queue:work --sleep=3 --tries=3 --max-time=3600
```

### 3. ุชูุธู Cache
ุจุฑุง ุฐุฎุฑู ูุถุนุช jobโูุง:
```bash
# ุฏุฑ .env
CACHE_DRIVER=redis
# ุง
CACHE_DRIVER=database
```

## ๐ฑ ุงุนูุงูโุฑุณุงู ุชูฺฏุฑุงู:

ุงฺฏุฑ ุณุฑูุณ ุชูฺฏุฑุงู ุฑุงูโุงูุฏุงุฒ ุดุฏู ุจุงุดุฏุ ฺฉุงุฑุจุฑุงู ุงุนูุงู ุฏุฑุงูุช ูโฺฉููุฏ:
- โ ููููุช: ุชุนุฏุงุฏ ุฎุงููุงุฏูโูุง ู ุงุนุถุง ุซุจุช ุดุฏู
- โ ุฎุทุง: ุชูุถุญ ุฎุทุง ู ุฑุงูููุง ุฑูุน

## ๐จ ูฺฉุงุช ููู:

### ุงููุช:
- ููุท ฺฉุงุฑุจุฑุงู ุจุง role `charity` ุฏุณุชุฑุณ ุฏุงุฑูุฏ
- Permission `create family` ุงูุฒุงู ุงุณุช
- ูุงูโูุง ูููุช ุจุนุฏ ุงุฒ ูพุฑุฏุงุฒุด ุญุฐู ูโุดููุฏ

### ุนููฺฉุฑุฏ:
- Cache: ูุถุนุช jobโูุง 1 ุณุงุนุช ูฺฏูุฏุงุฑ ูโุดูุฏ
- Timeout: Jobโูุง ุญุฏุงฺฉุซุฑ 30 ุฏููู ูุฑุตุช ุฏุงุฑูุฏ
- Retry: ุฏุฑ ุตูุฑุช ุดฺฉุณุชุ 3 ุจุงุฑ ุชูุงุด ูโุดูุฏ

### ูุฑูุช ูุงู:
- ูพุดุชุจุงู: `.xlsx`, `.xls`, `.csv`
- ุญุฏุงฺฉุซุฑ ุณุงุฒ: 10MB
- ุญุฏุงฺฉุซุฑ ุชุนุฏุงุฏ ุฑุฏู: ุจุฏูู ูุญุฏูุฏุช (ุจุง Queue)

## ๐ ููููู ุงุณุชูุงุฏู:

```php
// ุชุณุช manual
$job = new ProcessFamiliesImport($user, $regionId, $filePath, $fileName);
dispatch($job);

// ฺฺฉ ูุถุนุช  
$status = Cache::get("import_job_{$jobId}");
```

## ๐ ูุงูุชูุฑูฺฏ:

### ูุงฺฏโูุง:
- `storage/logs/laravel.log` - ูุงฺฏโูุง ฺฉู
- Queue failures ุฏุฑ ุฌุฏูู `failed_jobs`

### ุขูุงุฑ:
- ุชุนุฏุงุฏ jobโูุง ุฏุฑ ุตู: `php artisan queue:status`
- ฺฉุงุฑุง worker: ูุงูุชูุฑ ุชุนุฏุงุฏ ูพุฑุฏุงุฒุด ุดุฏู

---

> **ูฺฉุชู**: ุจุฑุง ุชุณุช ูุญู ูโุชูุงูุฏ ุจุง ุฏุณุชูุฑ `php artisan queue:work` worker ุฑุง ุงุฌุฑุง ฺฉูุฏ ู ูุงู ุขูพููุฏ ฺฉูุฏ. 